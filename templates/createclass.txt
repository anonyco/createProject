#!/bin/sh                                                                                                                            
# SPDX-License-Identifier: GPL-3.0-only or GPL-3.0-or-later
                                      
# Takes 2 arguments and both are mandatory.
# Relative path to directory where to place header file should be first argument.
# Name of class to be used should be second argument.
# First argument should always be at least `include` and if path contains subdirectories then the additional directory 
# hierarchy should already have been added to both the `include` and `src` directories before calling this script.

# IOW `./createclass include Player` will create `player.h` in `include` directory and `player.cpp` in `src` directory.
# But if you want to for example add a Vertex class to a `Shaders` sub-directory of your `include` then a subdirectory 
# with the name `Shaders` should already exist in both `include` and `src` before you call this script and the call
# for that would be `./createclass include/shaders Vertex`

#from https://github.com/dylanaraps/pure-sh-bible
lstrip() {
    # Usage: lstrip "string" "pattern"
    printf '%s\n' "${1##$2}"
}

upperedSecondArgument=$(echo $2 | tr [:lower:] [:upper:])
loweredSecondArgument=$(echo $2 | tr [:upper:] [:lower:])
classTemplate=/home/$USER/createProject/templates/classTemplate.txt

sed "s:includename:$upperedSecondArgument:g" $classTemplate > "$1/$loweredSecondArgument.h"
sed "s:className:$2:g" "$1/$loweredSecondArgument.h" > dummy
mv dummy "$1/$loweredSecondArgument.h"

subpath=$(
    IFS='include'
)

CPPFILE=""
INCPATH="$1"
INCLUDELENGTH=${#INCPATH}
SIMPLE="include"

if [ "$INCPATH" = "$SIMPLE" ]; then
    INCPATH="$loweredSecondArgument.h"
    CPPFILE="src/$loweredSecondArgument.cpp"
else
    subpath=$(lstrip $1 'include/')
    CPPFILE="src/$subpath/$loweredSecondArgument.cpp"
    INCPATH=$subpath/$loweredSecondArgument.h    
fi

sed "s:src/main.cpp:$CPPFILE\nsrc/main.cpp:g" CMakeLists.txt > dummy
mv dummy CMakeLists.txt

touch $CPPFILE

printf "#include \"$INCPATH\"" > $CPPFILE
printf "\n\n\n\n$2::$2(){}\n\n\n$2::~$2(){}" >> $CPPFILE

